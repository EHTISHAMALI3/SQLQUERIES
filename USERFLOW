CREATE TABLE Users (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    RollNo NVARCHAR(50) UNIQUE NULL,
    FirstName NVARCHAR(255) NOT NULL,
    LastName NVARCHAR(255) NOT NULL,
    UserName NVARCHAR(255) NOT NULL UNIQUE,
    NormalizedUserName NVARCHAR(255) NOT NULL UNIQUE,
    Email NVARCHAR(255) NOT NULL UNIQUE,
    NormalizedEmail NVARCHAR(255) NOT NULL UNIQUE,
    PasswordHash NVARCHAR(MAX) NOT NULL,
    SecurityStamp NVARCHAR(MAX) NULL,
    ConcurrencyStamp NVARCHAR(MAX) NULL,
    ContactNo NVARCHAR(50) NULL,
    Address NVARCHAR(500) NULL,
    City NVARCHAR(255) NULL,
    Province NVARCHAR(255) NULL,
    Zip NVARCHAR(50) NULL,
    PhoneNumberConfirmed BIT NOT NULL DEFAULT 0,
    IsActive BIT NOT NULL DEFAULT 1,
    EmailConfirmed BIT NOT NULL DEFAULT 0,
    LockoutEnd DATETIME2 NULL,
    LockoutEnabled BIT NOT NULL DEFAULT 1,
    AccessFailedCount INT NOT NULL DEFAULT 0,
    IsLockedOut BIT NOT NULL DEFAULT 0,
    LastLoginDate DATETIME2 NULL,
    DOB DATE NULL,
    Gender NVARCHAR(50) NULL,
    RefreshToken NVARCHAR(MAX) NULL,
    RefreshTokenExpiryTime DATETIME2 NULL,
    UserTypeId UNIQUEIDENTIFIER NOT NULL,
    ClassId UNIQUEIDENTIFIER NULL,
    SchoolId UNIQUEIDENTIFIER NULL,
    SessionId UNIQUEIDENTIFIER NULL,
    ProfileImage NVARCHAR(MAX) NULL,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_Users_UserTypes FOREIGN KEY (UserTypeId) REFERENCES UserTypes(Id) ON DELETE CASCADE
);






CREATE TABLE Sessions (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    SessionName NVARCHAR(255) NOT NULL UNIQUE,
    CreatedBy UNIQUEIDENTIFIER NULL,
    IsActive BIT NOT NULL DEFAULT 1,
    SessionStartDate DATE NOT NULL,
    SessionEndDate DATE NOT NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0
);



CREATE TABLE Schools (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    SchoolName NVARCHAR(255) NOT NULL UNIQUE,
    SchoolAddress NVARCHAR(500) NOT NULL,
    OwnerName NVARCHAR(255) NOT NULL,
    SchoolLogo NVARCHAR(MAX) NULL,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0
);



CREATE TABLE Classes (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    ClassName NVARCHAR(255) NOT NULL UNIQUE,
    SchoolId UNIQUEIDENTIFIER NOT NULL,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_Classes_School FOREIGN KEY (SchoolId) REFERENCES Schools(Id)
);


CREATE TABLE UserTypes (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    UserType NVARCHAR(100) NOT NULL UNIQUE,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0
);

INSERT INTO UserTypes (Id, UserType, CreatedAt)
VALUES 
    (NEWID(), 'Super Admin', GETUTCDATE()),
    (NEWID(), 'Admin', GETUTCDATE()),
    (NEWID(), 'User', GETUTCDATE());


CREATE TABLE UserRoles (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    UserId UNIQUEIDENTIFIER NOT NULL,
    UserTypeId UNIQUEIDENTIFIER NOT NULL,
    AssignedBy UNIQUEIDENTIFIER NULL,
    AssignedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),

    CONSTRAINT FK_UserRoles_Users FOREIGN KEY (UserId) REFERENCES Users(Id) ON DELETE CASCADE,
    CONSTRAINT FK_UserRoles_UserTypes FOREIGN KEY (UserTypeId) REFERENCES UserTypes(Id) ON DELETE CASCADE
);


CREATE TABLE AccessManagement (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    UserTypeId UNIQUEIDENTIFIER NOT NULL,
    CanRead BIT NOT NULL DEFAULT 1,
    CanCreate BIT NOT NULL DEFAULT 0,
    CanUpdate BIT NOT NULL DEFAULT 0,
    CanDelete BIT NOT NULL DEFAULT 0,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),

    CONSTRAINT FK_AccessManagement_UserTypes FOREIGN KEY (UserTypeId) REFERENCES UserTypes(Id) ON DELETE CASCADE
);



INSERT INTO AccessManagement (UserTypeId, CanRead, CanCreate, CanUpdate, CanDelete, CreatedAt)
SELECT Id, 1, 1, 1, 1, GETUTCDATE() FROM UserTypes WHERE UserType = 'Super Admin';

INSERT INTO AccessManagement (UserTypeId, CanRead, CanCreate, CanUpdate, CanDelete, CreatedAt)
SELECT Id, 1, 1, 1, 0, GETUTCDATE() FROM UserTypes WHERE UserType = 'Admin';

INSERT INTO AccessManagement (UserTypeId, CanRead, 0, 0, 0, GETUTCDATE())
SELECT Id FROM UserTypes WHERE UserType = 'User';




CREATE TABLE Pages (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    PageName NVARCHAR(255) NOT NULL UNIQUE,
    Route NVARCHAR(500) NOT NULL UNIQUE,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0
);


CREATE TABLE PageContents (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    PageId UNIQUEIDENTIFIER NOT NULL,
    ContentType NVARCHAR(50) NOT NULL, -- e.g., 'text', 'image', 'html'
    Content NVARCHAR(MAX) NULL, -- Can store text, HTML, or image paths
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_PageContents_Pages FOREIGN KEY (PageId) REFERENCES Pages(Id) ON DELETE CASCADE
);

CREATE TABLE CMS_Content (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    Page NVARCHAR(255) NOT NULL,  -- e.g., 'Institutions'
    Section NVARCHAR(255) NOT NULL, -- e.g., 'Institution Name'
    Content NVARCHAR(MAX) NULL,  -- Store text, labels, placeholders
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL
);

CREATE TABLE Institutions (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    InstitutionName NVARCHAR(255) NOT NULL,
    InstitutionType NVARCHAR(255) NOT NULL,
    InstitutionLogo NVARCHAR(MAX) NULL,
    InstitutionThemeColors NVARCHAR(50) NULL,
    InstitutionEmail NVARCHAR(255) NULL,
    InstitutionPhone NVARCHAR(50) NULL,
    WebsiteURL NVARCHAR(500) NULL,
    DateOfEstablishment DATE NULL,
    HeadOfficeAddress NVARCHAR(500) NULL,
    Street NVARCHAR(255) NULL,
    City NVARCHAR(255) NULL,
    StateProvince NVARCHAR(255) NULL,
    PostalCode NVARCHAR(50) NULL,
    Country NVARCHAR(255) NULL,
    PrimaryContactFullName NVARCHAR(255) NULL,
    PrimaryContactJobTitle NVARCHAR(255) NULL,
    PrimaryContactEmail NVARCHAR(255) NULL,
    PrimaryContactPhoneNumber NVARCHAR(50) NULL,
    InstitutionStatus NVARCHAR(100) NULL,  -- Active, Pending, etc.
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0
);

CREATE TABLE Branches (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    InstitutionId UNIQUEIDENTIFIER NOT NULL,
    BranchName NVARCHAR(255) NOT NULL,
    BranchAddress NVARCHAR(500) NULL,
    ContactNumber NVARCHAR(50) NULL,
    Email NVARCHAR(255) NULL,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_Branches_Institutions FOREIGN KEY (InstitutionId) REFERENCES Institutions(Id) ON DELETE CASCADE
);

CREATE TABLE Staff (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    InstitutionId UNIQUEIDENTIFIER NOT NULL,
    FullName NVARCHAR(255) NOT NULL,
    JobTitle NVARCHAR(255) NOT NULL,
    Email NVARCHAR(255) NOT NULL,
    Phone NVARCHAR(50) NULL,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_Staff_Institutions FOREIGN KEY (InstitutionId) REFERENCES Institutions(Id) ON DELETE CASCADE
);

CREATE TABLE Labs (
    Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    InstitutionId UNIQUEIDENTIFIER NOT NULL,
    LabName NVARCHAR(255) NOT NULL,
    LabType NVARCHAR(255) NULL,
    CreatedBy UNIQUEIDENTIFIER NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    ModifiedBy UNIQUEIDENTIFIER NULL,
    ModifiedAt DATETIME2 NULL,
    Deleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_Labs_Institutions FOREIGN KEY (InstitutionId) REFERENCES Institutions(Id) ON DELETE CASCADE
);
create table HY_Tbl_ContentlabelInfo(
id int primary key identity(1,1),
labelDetails varchar(max),
labelUsedFor varchar(max),
ImgpathIfExists varchar(max),
created_by varchar(255),
created_date datetime,
modified_by varchar(255),
modified_date datetime,
deleted bit default 0,
Source varchar(255) not null
)
